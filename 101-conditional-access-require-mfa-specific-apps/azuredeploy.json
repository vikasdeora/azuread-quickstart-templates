{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "policyName": 
	{
            "defaultValue": "SecurityTemplateRequireMfa",
            "type": "String"
        },
	"audience": {
            "defaultValue": "fill after deployment",
            "type": "String"
        },
	"clientID": {
            "defaultValue": "fill after deployment",
            "type": "String"
        },
	"clientSecret": {
            "defaultValue": "fill after deployment",
            "type": "String"
        },
	"conditionalAccessBaseUrl": {
            "defaultValue": "fill after deployment",
            "type": "String"
        },
	"includeApplications": {
            "defaultValue": ["fill after deployment"],
            "type": "Array"
        },
	"includeUsers": {
            "defaultValue": ["fill after deployment"],
            "type": "Array"
        },
	"msGraphVersion": {
            "defaultValue": "beta",
            "type": "String"
        },
	"tenantID": {
            "defaultValue": "fill after deployment",
            "type": "String"
        }
	
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.Logic/workflows",
            "apiVersion": "2017-07-01",
            "name": "[parameters('policyName')]",
            "location": "centralus",
            "properties": {
                "state": "Enabled",
                "definition": {
                    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                        "audience": {
                            "defaultValue": "[parameters('audience')]",
                            "type": "String"
                        },
                        "clientID": {
                            "defaultValue": "[parameters('clientID')]",
                            "type": "String"
                        },
                        "clientSecret": {
                            "defaultValue": "[parameters('clientSecret')]",
                            "type": "SecureString"
                        },
                        "conditionalAccessBaseUrl": {
                            "defaultValue": "[parameters('conditionalAccessBaseUrl')]",
                            "type": "String"
                        },
                        "includeApplications": {
                            "defaultValue": "[parameters('includeApplications')]",
                            "type": "Array"
                        },
                        "includeUsers": {
                            "defaultValue": "[parameters('includeUsers')]",
                            "type": "Array"
                        },
                        "msGraphVersion": {
                            "defaultValue": "[parameters('msGraphVersion')]",
                            "type": "String"
                        },
                        "tenantID": {
                            "defaultValue": "[parameters('tenantID')]",
                            "type": "String"
                        }
                    },
                    "triggers": {
                        "manual": {
                            "type": "Request",
                            "kind": "Http",
                            "inputs": {
                                "schema": {}
                            }
                        }
                    },
                    "actions": {
                        "Compose_JSON_for_Security_Templates:_Require_MFA_Specific_App": {
                            "runAfter": {},
                            "type": "Compose",
                            "inputs": {
                                "value": [
                                    {
                                        "conditions": {
                                            "applications": {
                                                "excludeApplications": [],
                                                "includeApplications": "@parameters('includeApplications')",
                                                "includeUserActions": []
                                            },
                                            "clientAppTypes": [],
                                            "deviceStates": null,
                                            "locations": null,
                                            "platforms": null,
                                            "signInRiskLevels": [],
                                            "users": {
                                                "excludeGroups": [],
                                                "excludeRoles": [],
                                                "excludeUsers": [],
                                                "includeGroups": [],
                                                "includeRoles": [],
                                                "includeUsers": "@parameters('includeUsers')"
                                            }
                                        },
                                        "displayName": "Security Templates: Require MFA Specific App",
                                        "grantControls": {
                                            "builtInControls": [
                                                "mfa"
                                            ],
                                            "customAuthenticationFactors": [],
                                            "operator": "OR",
                                            "termsOfUse": []
                                        },
                                        "sessionControls": null,
                                        "state": "enabled"
                                    }
                                ]
                            }
                        },
                        "[POST]_Security_Templates:_Require_MFA_Specific_App": {
                            "runAfter": {
                                "Compose_JSON_for_Security_Templates:_Require_MFA_Specific_App": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Http",
                            "inputs": {
                                "authentication": {
                                    "audience": "@parameters('audience')",
                                    "clientId": "@parameters('clientID')",
                                    "secret": "@parameters('clientSecret')",
                                    "tenant": "@parameters('tenantID')",
                                    "type": "ActiveDirectoryOAuth"
                                },
                                "body": "@outputs('Compose_JSON_for_Security_Templates:_Require_MFA_Specific_App')",
                                "headers": {
                                    "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "https://graph.microsoft.com/@{parameters('msGraphVersion')}/@{parameters('conditionalAccessBaseUrl')}"
                            }
                        }
                    },
                    "outputs": {}
                },
                "parameters": {}
            }
        }
    ]
}
