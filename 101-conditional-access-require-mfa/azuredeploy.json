
{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "policyName": 
	{
            "defaultValue": "security template: require mfa",
            "type": "String"
        },
	"clientID": {
            "defaultValue": "clientIDValue",
            "type": "String"
        },
	"clientSecret": {
            "defaultValue": "clientSecretValue",
            "type": "String"
        },
	"tenantID": {
            "defaultValue": "tenantIDValue",
            "type": "String"
        }
	
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.Logic/workflows",
            "apiVersion": "2017-07-01",
            "name": "[parameters('policyName')]",
            "location": "centralus",
            "properties": {
                "state": "Enabled",
                "definition": {
                    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                     
                        "clientID": {
                            "defaultValue": "[parameters('clientID')]",
                            "type": "String"
                        },
                        "clientSecret": {
                            "defaultValue": "[parameters('clientSecret')]",
                            "type": "SecureString"
                        },
                      
                        "tenantID": {
                            "defaultValue": "[parameters('tenantID')]",
                            "type": "String"
                        }
                    },
                    "triggers": {
                        "manual": {
                            "type": "Request",
                            "kind": "Http",
                            "inputs": {
                                "schema": {}
                            }
                        }
                    },
                    "actions": {
                        "Compose_JSON_for_Security_Templates:_Require_MFA": {
                            "runAfter": {},
                            "type": "Compose",
                            "inputs": {
                                "value": [
                                   {
  "conditions": {
    "applications": {
      "excludeApplications": [],
      "includeApplications": [
        "All"
      ],
      "includeUserActions": []
    },
    "clientAppTypes": [],
    "deviceStates": null,
    "locations": null,
    "platforms": null,
    "signInRiskLevels": [],
    "users": {
      "excludeGroups": [],
      "excludeRoles": [],
      "excludeUsers": [],
      "includeGroups": [],
      "includeRoles": [],
      "includeUsers": [
        "All"
      ]
    }
  },
  "createdDateTime": null,
  "displayName": "Template: Require MFA",
  "grantControls": {
    "builtInControls": [
      "mfa"
    ],
    "customAuthenticationFactors": [],
    "operator": "OR",
    "termsOfUse": []
  },
  "modifiedDateTime": null,
  "sessionControls": null,
  "state": "enabledForReportingButNotEnforced"
}
                                ]
                            }
                        },
                        "[POST]_Security_Templates:_Require_MFA": {
                            "runAfter": {
                                "Compose_JSON_for_Security_Templates:_Require_MFA": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Http",
                            "inputs": {
                                "authentication": {
                                    "audience": "https://graph.microsoft.com",
                                    "clientId": "@parameters('clientID')",
                                    "secret": "@parameters('clientSecret')",
                                    "tenant": "@parameters('tenantID')",
                                    "type": "ActiveDirectoryOAuth"
                                },
                                "body": "@outputs('Compose_JSON_for_Security_Templates:_Require_MFA')",
                                "headers": {
                                    "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "https://graph.microsoft.com/beta/conditionalAccess/policies"
                            }
                        }
                    },
                    "outputs": {}
                },
                "parameters": {}
            }
        }
    ]
}
